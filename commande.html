<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chez Daka - Commandes</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="css/web.css">
</head>
<body>
  <div class="container">
      <!-- Navbar -->
          <div class="navbar">
            <div>
                <img src="images/logo.jpeg" alt="Chez Daka Logo">
            </div>
            <div class="nav-links">
                <a href="index.html"><i class="fa-solid fa-house"></i></a>
                <a href="commande.html"><i class="fa-solid fa-cart-shopping"></i></a>
                 <a href="faq.html"><i class="fa-solid fa-question-circle"></i></a>
            </div>
        </div>
    <h1> Commandez Maintenant</h1>
    <form id="orderForm">
      
      <h1>Produits</h2>

      <div class="grid-container">

      <div class="column" id="fruits-column">
        <h3>Fruits</h3>
        <div class="product-card" id="fruitTemplate">
          <label>Type:</label>
          <select name="fruitType">
            <option value="">Choisissez un fruit</option>
            <option value="Abricot">Abricot</option>
            <option value="Açaï">Açaï</option>
            <option value="Acerola">Acerola</option>
            <option value="Ananas">Ananas</option>
            <option value="Avocat">Avocat</option>
            <option value="Baie de goji">Baie de goji</option>
            <option value="Baies">Baies</option>
            <option value="Banane">Banane</option>
            <option value="Canistel">Canistel</option>
            <option value="Carambole">Carambole</option>
            <option value="Cerise">Cerise</option>
            <option value="Citron">Citron</option>
            <option value="Clémentine">Clémentine</option>
            <option value="Coing">Coing</option>
            <option value="Datte">Datte</option>
            <option value="Durian">Durian</option>
            <option value="Figue">Figue</option>
            <option value="Fruit de la passion">Fruit de la passion</option>
            <option value="Grenade">Grenade</option>
            <option value="Goyave">Goyave</option>
            <option value="Kiwi">Kiwi</option>
            <option value="Litchi">Litchi</option>
            <option value="Mangue">Mangue</option>
            <option value="Melon">Melon</option>
            <option value="Orange">Orange</option>
            <option value="Papaye">Papaye</option>
            <option value="Pastèque">Pastèque</option>
            <option value="Pêche">Pêche</option>
            <option value="Poire">Poire</option>
            <option value="Pomme">Pomme</option>
            <option value="Prune">Prune</option>
            <option value="Raisin">Raisin</option>
          </select>
          <label>Variété:</label>
            <select name="fruitVariety" class="variety-select">
              <option value="">Sélectionnez une variété</option>
            </select>
          <label>Quantité:</label>
          <input type="number" name="fruitQuantity" placeholder="Quantité" min="1"><br><br>
          <label>Commentaire (calibre, quantité plus précise...) </label>
          <input type="text" name="fruitComment" placeholder="Commentaire" >
          <p> --------------------------------------- </p>
        </div>
        <button type="button" class="add-button" onclick="addProduct('fruits-column', 'fruitTemplate')"> + </button>
      </div>

      <!-- Colonne des Légumes -->
      <div class="column" id="legumes-column">
        <h3>Légumes</h3>
        <div class="product-card" id="legumeTemplate">
          <label>Type:</label>
          <select name="legumeType">
            <option value="">Choisissez un légume</option>
            <option value="Artichaut">Artichaut</option>
            <option value="Asperge">Asperge</option>
            <option value="Aubergine">Aubergine</option>
            <option value="Betterave">Betterave</option>
            <option value="Brocoli">Brocoli</option>
            <option value="Carotte">Carotte</option>
            <option value="Céleri">Céleri</option>
            <option value="Chou">Chou</option>
            <option value="Concombre">Concombre</option>
            <option value="Courge">Courge</option>
            <option value="Courgette">Courgette</option>
            <option value="Épinard">Épinard</option>
            <option value="Haricot">Haricot</option>
            <option value="Laitue">Laitue</option>
            <option value="Navet">Navet</option>
            <option value="Oignon">Oignon</option>
            <option value="Patate douce">Patate douce</option>
            <option value="Poireau">Poireau</option>
            <option value="Pomme de terre">Pomme de terre</option>
            <option value="Radis">Radis</option>
            <option value="Tomate">Tomate</option>
          </select>
          <label>Variété:</label>
            <select name="legumeVariety" class="variety-select">
              <option value="">Sélectionnez une variété</option>
            </select>
          <label>Quantité: </label>
          <input type="number" name="legumeQuantity" placeholder="Quantité " min="1"><br><br>  
          <label>Commentaire (calibre, quantité plus précise...) </label>
          <input type="text" name="legumeComment" placeholder="Commentaire" >
          <p> ---------------------------------------- </p>
        </div>
        <button type="button" class="add-button" onclick="addProduct('legumes-column', 'legumeTemplate')"> + </button>
      </div>

      <!-- Colonne des Condiments -->
      <div class="column" id="condiments-column">
        <h3>Condiments</h3>
        <div class="product-card" id="condimentTemplate">
          <label>Type:</label>
          <select name="condimentType">
            <option value="">Choisissez un condiment</option>
            <option value="Ail">Ail</option>
            <option value="Aneth">Aneth</option>
            <option value="Basilic">Basilic</option>
            <option value="Ciboulette">Ciboulette</option>
            <option value="Coriandre">Coriandre</option>
            <option value="Estragon">Estragon</option>
            <option value="Menthe">Menthe</option>
            <option value="Origan">Origan</option>
            <option value="Persil">Persil</option>
            <option value="Romarin">Romarin</option>
            <option value="Sauge">Sauge</option>
            <option value="Thym">Thym</option>
          </select>
          <label>Variété:</label>
          <select name="condimentVariety" class="variety-select">
            <option value="">Sélectionnez une variété</option>
          </select>
          <label>Quantité:</label>
          <input type="number" name="condimentQuantity" placeholder="Quantité" min="1"><br><br>  
          <label>Commentaire (calibre, quantité plus précise...) </label>
          <input type="text" name="condimentComment" placeholder="Commentaire" >
          <p> ---------------------------------------- </p>
        </div>
        <button type="button" class="add-button" onclick="addProduct('condiments-column', 'condimentTemplate')"> + </button>
      </div>

      <!-- Colonne des Fruits secs -->
      <div class="column" id="fruitSecs-column">
        <h3>Fruits Secs</h3>
        <div class="product-card" id="fruitSecTemplate">
          <label>Type:</label>
          <select name="fruitSecType">
            <option value="">Choisissez un fruit sec</option>
            <option value="Amande">Amande</option>
            <option value="Cajou">Cajou</option>
            <option value="Noix">Noix</option>
            <option value="Noisette">Noisette</option>
            <option value="Pistache">Pistache</option>
          </select>
          <label>Variété:</label>
          <select name="fruitSecVariety" class="variety-select">
            <option value="">Sélectionnez une variété</option>
          </select>
          <label>Quantité:</label>
          <input type="number" name="fruitSecQuantity" placeholder="Quantité" min="1"><br><br>  
          <label>Commentaire (calibre, quantité plus précise...) </label>
          <input type="text" name="fruitSecComment" placeholder="Commentaire" >
          <p> ---------------------------------------- </p>
        </div>
        <button type="button" class="add-button" onclick="addProduct('fruitsSecs-column', 'fruitSecTemplate')"> + </button>
      </div>

      <!-- Colonne des Exotiques -->
      <div class="column" id="exotiques-column">
        <h3>Fruits Exotiques</h3>
        <div class="product-card" id="exotiqueTemplate">
          <label>Type:</label>
          <select name="exotiqueType">
            <option value="">Choisissez un produit exotique</option>
            <option value="Bissap">Bissap</option>
            <option value="Corossol">Corossol</option>
            <option value="Carambole">Carambole</option>
            <option value="Durian">Durian</option>
            <option value="Gombo">Gombo</option>
            <option value="Jacquier">Jacquier</option>
            <option value="Kiwano">Kiwano</option>
            <option value="Safou">Safou</option>
            <option value="Tamarin">Tamarin</option>
            <option value="Ugli">Ugli</option>
          </select>
          <label>Variété:</label>
          <select name="exotiqueVariety" class="variety-select">
            <option value="">Sélectionnez une variété</option>
          </select>
          <label>Quantité:</label>
          <input type="number" name="exotiqueQuantity" placeholder="Quantité" min="1"><br><br> 
          <label>Commentaire (calibre, quantité plus précise...) </label>
          <input type="text" name="exotiqueComment" placeholder="Commentaire" >
          <p> ------------------------------------ </p>
        </div>
        <button type="button" class="add-button" onclick="addProduct('exotiques-column', 'exotiqueTemplate')"> + </button>
      </div>
    </div>

  <br>

  <div class="intro-card-command">
    <h2>Informations du Client</h2>
    <div class="form-group">
      <label for="customerName">Nom et Prénom :</label>
      <input type="text" id="customerName" name="customerName" placeholder="Votre nom complet" required>
    </div><br>
    <div class="form-group">
      <label for="businessName">Nom et adresse :</label>
      <input type="text" id="businessName" name="businessName" placeholder="Nom et adresse" required>
    </div><br>
    <div class="form-group">
      <label for="email">Adresse e-mail :</label>
      <input type="email" id="email" name="email" placeholder="Votre adresse e-mail" required>
    </div><br>
    <div class="form-group">
      <label for="phone">N° Téléphone :</label>
      <input type="text" id="phone" name="phone" placeholder="Votre N° de Téléphone" required>
    </div>
  </div>
  <br>

  <div class="intro-card-command">
    <h2>Date de livraison:</h2>
    <div class="form-group">
      <label for="orderDate">Sélectionnez une date :</label>
      <input type="date" id="orderDate" name="orderDate" required>
    </div>
    <h2>Type de Paiement:</h2>
    <div class="form-group">
      <select id="paymentType" name="paymentType" required>
        <option value="">Sélectionnez un type de paiement</option>
        <option value="Carte Bancaire">Carte Bancaire</option>
        <option value="Espèces">Espèces</option>
        <option value="Chèque">Chèque</option>
      </select>
      <p> Le paiement se fera au moment de la livraison de la commande.</p>
    </div>
    <h2>Lieu de Retrait:</h2>
    <select id="pickupLocation" name="pickupLocation" required>
      <option value="">Choisissez un lieu</option>
      <option value="Sausset">Sausset</option>
      <option value="Martigues">Martigues</option>
      <option value="Livraison">Livraison</option>
      <option value="Carry">Carry-le-rouet</option>
    </select>
  </div>

      <div id="orderSummary">
                <h2>Récapitulatif de la commande</h2>
                <div id="summaryItems"></div>
                <p>Total estimé : <span id="totalPrice">0 €</span></p>
            </div>

      <button type="submit">Valider la Commande</button>
    </form>
  </div>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"> </script>
  <script src="js/varieties.js"></script>
  <script type="text/javascript"> 

    document.addEventListener('DOMContentLoaded', function () {
      // Ajout des écouteurs pour les fruits
      document.querySelectorAll('select[name="fruitType"]').forEach(select => {
        select.addEventListener('change', function () {
          updateVarieties(this, 'fruit');
        });
      });

      // Ajout des écouteurs pour les légumes
      document.querySelectorAll('select[name="legumeType"]').forEach(select => {
        select.addEventListener('change', function () {
          updateVarieties(this, 'legume');
        });
      });

      // Ajout des écouteurs pour les condiments
      document.querySelectorAll('select[name="condimentType"]').forEach(select => {
        select.addEventListener('change', function () {
          updateVarieties(this, 'condiment');
        });
      });

      // Ajout des écouteurs pour les fruits secs
      document.querySelectorAll('select[name="fruitSecType"]').forEach(select => {
        select.addEventListener('change', function () {
          updateVarieties(this, 'fruitSec');
        });
      });

      // Ajout des écouteurs pour les fruits exotiques
      document.querySelectorAll('select[name="exotiqueType"]').forEach(select => {
        select.addEventListener('change', function () {
          updateVarieties(this, 'exotique');
        });
      });
    });

   
    function updateVarieties(selectElement, type) {
      const productType = selectElement.value; // Type de produit sélectionné (ex : "Abricot")
      const varietySelect = selectElement.closest('.product-card').querySelector('.variety-select');

      // Effacer les options existantes
      varietySelect.innerHTML = '<option value="">Sélectionnez une variété</option>';
      
      // Vérifier si le type de produit et les variétés existent
      if (productType && varieties[type][productType]) {
          // Utiliser Object.keys pour itérer sur les propriétés de l'objet
          Object.keys(varieties[type][productType]).forEach(variety => {
              const option = document.createElement('option');
              option.value = variety;
  
              // Ajouter le prix si disponible
              const price = varieties[type][productType][variety];
              if (price) {
                  option.textContent = `${variety} (${price}€/kg)`; 
              } else {
                  option.textContent = variety; 
              }
  
              varietySelect.appendChild(option); 
          });
      }
  }


    function addProduct(columnId, templateId) {
      const column = document.getElementById(columnId);
      const template = document.getElementById(templateId);
      const newProduct = template.cloneNode(true);

      // Supprimer l'ID pour éviter les doublons
      newProduct.removeAttribute("id");

      // Réinitialiser les champs
      newProduct.querySelectorAll("input, select").forEach(input => {
        input.value = "";
      });

      // Ajouter les écouteurs d'événements pour les nouveaux sélecteurs
      if (columnId === 'fruits-column') {
        newProduct.querySelector('select[name="fruitType"]').addEventListener('change', function () {
          updateVarieties(this, 'fruit');
        });
      } else if (columnId === 'legumes-column') {
        newProduct.querySelector('select[name="legumeType"]').addEventListener('change', function () {
          updateVarieties(this, 'legume');
        });
      } else if (columnId === 'condiments-column') {
        newProduct.querySelector('select[name="condimentType"]').addEventListener('change', function () {
          updateVarieties(this, 'condiment');
        });
      } else if (columnId === 'fruitSecs-column') {
        newProduct.querySelector('select[name="fruitSecType"]').addEventListener('change', function () {
          updateVarieties(this, 'fruitSec');
        });
      } else if (columnId === 'exotiques-column') {
        newProduct.querySelector('select[name="exotiqueType"]').addEventListener('change', function () {
          updateVarieties(this, 'exotique');
        });
      }

      column.insertBefore(newProduct, column.querySelector(".add-button"));
    }

    (function() {
      // Initialisation d'EmailJS avec votre clé publique (User ID)
      emailjs.init("-QMpEh1ZaF4qdF-fy"); 
    })();

    document.getElementById('orderForm').addEventListener('submit', function(event) {
    event.preventDefault();
    const fruits = [];
    const legumes = [];
    const fruitsSec = [];
    const condiments = [];
    const fruitExotiques = [];

    // Récupérer les fruits
    document.querySelectorAll('#fruits-column .product-card').forEach(product => {
      const type = product.querySelector('select[name="fruitType"]').value;
      const variety = product.querySelector('select[name="fruitVariety"]').value;
      const quantity = product.querySelector('input[name="fruitQuantity"]').value;
      const comment = product.querySelector('input[name="fruitComment"]').value;
      const price = product.querySelector('input[name="fruitPrice"]').value;

      if (type && quantity) {
        fruits.push({ type, variety, quantity,comment,price });
      }
    });

    // Récupérer les légumes
    document.querySelectorAll('#legumes-column .product-card').forEach(product => {
      const type = product.querySelector('select[name="legumeType"]').value;
      const variety = product.querySelector('select[name="legumeVariety"]').value;
      const quantity = product.querySelector('input[name="legumeQuantity"]').value;
      const comment = product.querySelector('input[name="legumeComment"]').value;
      const price = product.querySelector('input[name="legumePrice"]').value;

      if (type && quantity) {
        legumes.push({ type, variety, quantity,comment,price });
      }
    });

    // Récupérer les condiments
    document.querySelectorAll('#condiments-column .product-card').forEach(product => {
      const type = product.querySelector('select[name="condimentType"]').value;
      const variety = product.querySelector('select[name="condimentVariety"]').value;
      const quantity = product.querySelector('input[name="condimentQuantity"]').value;
      const comment = product.querySelector('input[name="condimentComment"]').value;
      const price = product.querySelector('input[name="condimentPrice"]').value;

      if (type && quantity) {
        condiments.push({ type, variety, quantity,comment,price });
      }
    });

    // Récupérer les fruits secs
    document.querySelectorAll('#fruitSecs-column .product-card').forEach(product => {
      const type = product.querySelector('select[name="fruitSecType"]').value;
      const variety = product.querySelector('select[name="fruitSecVariety"]').value;
      const quantity = product.querySelector('input[name="fruitSecQuantity"]').value;
      const comment = product.querySelector('input[name="fruitSecComment"]').value;
      const price = product.querySelector('input[name="fruitSecPrice"]').value;

      if (type && quantity) {
        fruitsSec.push({ type, variety, quantity,comment,price });
      }
    });

    // Récupérer les fruits exotiques
    document.querySelectorAll('#exotiques-column .product-card').forEach(product => {
      const type = product.querySelector('select[name="exotiqueType"]').value;
      const variety = product.querySelector('select[name="exotiqueVariety"]').value;
      const quantity = product.querySelector('input[name="exotiqueQuantity"]').value;
      const comment = product.querySelector('input[name="exotiqueComment"]').value;
      const price = product.querySelector('input[name="exotiquePrice"]').value;

      if (type && quantity) {
        fruitExotiques.push({ type, variety, quantity,comment,price });
      }
    });

    // Vérifiez si au moins un produit est sélectionné
    if (fruits.length === 0 && legumes.length === 0 && condiments.length === 0 && fruitsSec.length === 0 && fruitExotiques.length === 0) {
      alert('Veuillez sélectionner au moins un produit.');
      return;
    }

    // Récupérer les données client
    const customerName = document.getElementById('customerName').value;
    const businessName = document.getElementById('businessName').value;
    const orderDate = document.getElementById('orderDate').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const paymentType = document.getElementById('paymentType').value;
    const pickupLocation = document.getElementById('pickupLocation').value;

    if (!pickupLocation) {
      alert('Veuillez choisir un lieu de retrait.');
      return;
    }

    // Préparer les données pour l'affichage ou l'envoi
    const message = `
      Client : ${customerName}
      Email : ${email}
      Telephone: ${phone}
      Entreprise : ${businessName}
      Livraison : ${orderDate}
      Paiement : ${paymentType}
      Lieu de retrait : ${pickupLocation}

      Fruits :
      ${fruits.map(fruit => `- ${fruit.type} (${fruit.variety || "Aucune variété"}) : ${fruit.quantity} kg ${fruit.price} ${fruit.comment}`).join('\n')}

      Légumes :
      ${legumes.map(legume => `- ${legume.type} (${legume.variety || "Aucune variété"}) : ${legume.quantity} kg ${legume.price} ${legume.comment}`).join('\n')}

      Condiments :
      ${condiments.map(condiment => `- ${condiment.type} (${condiment.variety || "Aucune variété"}) : ${condiment.quantity} kg ${condiment.price} ${condiment.comment}`).join('\n')}

      Fruits Sec:
      ${fruitsSec.map(sec => `- ${sec.type} (${sec.variety || "Aucune variété"}) : ${sec.quantity} kg ${sec.price} ${sec.comment}`).join('\n')}

      Fruits Exotiques:
      ${fruitExotiques.map(exotique => `- ${exotique.type} (${exotique.variety || "Aucune variété"}) : ${exotique.quantity} kg ${exotique.price} ${exotique.comment}`).join('\n')}
    `;

    const templateParams = {
    customerName: customerName,
    email: email,
    phone: phone,
    businessName: businessName,
    paymentType: paymentType,
    pickupLocation: pickupLocation,
    message: message, // Inclure tout le message ici
  };

  emailjs
    .send("service_em0jxp8", "template_j5mzo3q", templateParams)
    .then(
      function (response) {
        console.log("E-mail envoyé avec succès :", response.status, response.text);
        alert("Votre commande a été envoyée avec succès !");
      },
      function (error) {
        console.error("Erreur lors de l'envoi :", error);
        alert("Une erreur s'est produite lors de l'envoi de la commande.");
      }
    );

  });

  </script>
</body>
</html>
